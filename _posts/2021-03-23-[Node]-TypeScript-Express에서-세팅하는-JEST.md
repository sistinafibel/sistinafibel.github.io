---
layout: post
title: '[Node] TypeScript Expressì—ì„œ ì„¸íŒ…í•˜ëŠ” JEST'
date: 2021-03-23
author: cloudjun
tags: node jest express
---
ì–¸ì œê¹Œì§€ í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ í•˜ë‚˜í•˜ë‚˜ ëˆŒëŸ¬ë³´ë©° í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ”ê±´ ë¶ˆì•ˆí•¨ì˜ ì—°ì†ì´ë‹¤. ì‹¤ì œ ë¼ì´ë¸Œê°€ ë˜ëŠ” ì„œë¹„ìŠ¤ì¼ìˆ˜ë¡ ê¸°ëŠ¥ì€ ë§¤ìš° ë§Žì•˜ê³  ë¡œì§ì˜ ë³€í™”ë„ ì–´ë””ì— ë¬¸ì œê°€ ìƒê¸¸ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ë³´ìˆ˜ì ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ë¥¼ í•  ìˆ˜ ë°–ì— ì—†ë‹¤. ìƒˆë¡œìš´ íŒ¨í„´ìœ¼ë¡œ ê³ ë„í™”ë¥¼ ì ìš© ì‹œí‚¤ë ¤ í•´ë„ ì´ë¯¸ ìž˜ ëŒì•„ê°€ëŠ” ì„œë¹„ìŠ¤ë¥¼ ê±´ë“ ë‹¤ëŠ”ê±´ ê¸°ìˆ ë¶€ì±„ì˜ í­íƒ„ì„ í•´ì²´í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤ë³´ë‹ˆ ê²°êµ­ í•´ì²´í•´ì•¼í•˜ëŠ” í­íƒ„ì„ ë”ìš± ì‰½ê²Œ í•´ì²´í•˜ê³ ìž TDDë¥¼ ë„ìž…í•˜ìž ë§ˆìŒë¨¹ì—ˆë‹¤.

![Untitled](https://user-images.githubusercontent.com/36251104/112114905-f184da80-8bfb-11eb-804e-88c140d65c4e.png)

> í­íƒ„ì„ í•´ì²´í•˜ëŠ” ë„êµ¬ë¥¼ ì–»ëŠ”ë‹¤ í•´ë„ ê·¸ê±´ ë„ì›€ì„ ì£¼ëŠ” ë„êµ¬ì¼ ë¿ í„°ì§€ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì†Œë¦¬ê°€ ì•„ë‹ˆë‹¤. TDDì—ì„œ ì˜ˆìƒí•˜ì§€ ëª»í•˜ëŠ” ì˜ˆì™¸ìƒí™©ì€ ë¶„ëª…ížˆ ìžˆë‹¤.

ê·¸ë¦¬ê³  ì´ ê¸€ì„ ì“°ê²Œ ëœ í•µì‹¬ì ì¸ ì´ìœ ëŠ” TypeScript + Express + JESTë¥¼  ëª¨ë‘ ì„¤ì •í•˜ëŠ” ê¸€ì´ ë³„ë¡œ ë§Žì§€ ì•Šì•˜ë‹¤. 

êµ¬ ë²„ì „ ê¸€ë„ ë§Žì•˜ê³ .. ì´ìƒí•˜ê²Œ ì„¤ì¹˜í•˜ëŠ”ë° ì‚½ì§ˆì„ í•˜ë‹¤ë³´ë‹ˆ ì„¤ì •í•˜ëŠ” ê³¼ì •ì„ ì •ë¦¬í•œë‹¤.

## ðŸ‘€ ì™œ JEST ì¸ê°€?

~~ë‘˜ë‹¤ ë˜‘ê°™ì€ ì—¬ìš°ì¸ë°~~

![Untitled 1](https://user-images.githubusercontent.com/36251104/112114883-ec279000-8bfb-11eb-895d-00f6e42959d1.png)

ì´ ì§¤ì´ ì°¸ ë§ˆìŒì— ë“œëŠ” ì´ìœ ì¸ë°, ê²°êµ­ ì–´ì°¨í”¼ í…ŒìŠ¤íŠ¸ ë„êµ¬ëŠ” ì„±ëŠ¥ì— ì´ìŠˆë¥¼ ë¯¸ì¹˜ëŠ”ê²Œ ì•„ë‹ˆë‹ˆ ìžì‹ ì—ê²Œ íŽ¸í•œê±° ì“°ë©´ ëœë‹¤. 

êµ­ë‚´ ë ˆí¼ëŸ°ìŠ¤ëŠ” MOCHA ìžë£Œë³´ë‹¤ëŠ” JEST ìžë£Œê°€ ë§Žì•˜ê³  í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì— ì¶©ì‹¤í•œ JESTë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.

ì–´ì°¨í”¼ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ” íˆ´ì´ë‹ˆ íŽ¸í•œê±° ì“°ë©´ ëœë‹¤.

## â³ JEST ì„¤ì¹˜í•˜ê¸°

jestëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì—ì…‹ìœ¼ë¡œ ìš°ë¦¬ëŠ” typescriptë¥¼ í¬í•¨í•˜ì—¬ ì‚¬ìš©í•˜ë‹ˆ ts-jestë„ ê°™ì´ ë°›ëŠ”ë‹¤.

supertestëŠ” request í†µì‹ ì„  ë§Œë“¤ì–´ì£¼ëŠ” ì—­í™œì„ í•˜ëŠ”ë°, express í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í•„ìš”í•˜ë‹¤.

```tsx
npm install jest ts-jest @types/jest supertest
```

jest.config.js íŒŒì¼ì„ í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ë§Œë“¤ì–´ì£¼ê³  ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ìž‘ì„±í•˜ì—¬ jestê°€ ts-jestë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì•Œë ¤ì£¼ìž

```tsx
module.exports = {
  preset: "ts-jest", // ì´ ë¶€ë¶„ì—ì„œ ts-jestë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì•Œë ¤ì¤€ë‹¤
  testEnvironment: "node", //í…ŒìŠ¤íŠ¸ í™˜ê²½ 'node' í™˜ê²½ì„ ì‚¬ìš©í•œë‹¤ ì•Œë ¤ì¤Œ
  testMatch: ["**/tests/*.test.(ts|tsx)"] //js íŒŒì¼ì€ distì—ì„œë„ ê°ì§€ê°€ ë  ìˆ˜ ìžˆìœ¼ë‹ˆ í´ë”ë¥¼ ì¡°ì •í•´ì„œ testì´ ìžˆëŠ” ìœ„ì¹˜ë¡œ ìž¡ì•„ì¤€ë‹¤. 
};
```

ì¶”ê°€ ì„¤ì •ì€ [https://jestjs.io/docs/configuration](https://jestjs.io/docs/configuration) ì—¬ê¸°ì—ì„œ í™•ì¸ í•  ìˆ˜ ìžˆë‹¤.

ì´í›„ package.jsonì„ ìˆ˜ì •í•´ì„œ jestë¥¼ ì‚¬ìš© í•  ìˆ˜ ìžˆê²Œ ì„¤ì •í•œë‹¤.

```tsx
"scripts": {
  "test": "jest --setupFiles dotenv/config --forceExit --detectOpenHandles"
}
```

> ðŸ”¥ í˜¹ì‹œ env íŒŒì¼ì„ ì‚¬ìš©ì¤‘ì´ë¼ë©´ jest â€”setupFiles dotenv/configë¥¼ ê¼­ ë„£ì–´ì„œ ì‚¬ìš©í•´ì•¼í•œë‹¤. ì•ˆí•˜ë©´ í™˜ê²½ì„¤ì •ì„ ê°€ì ¸ì˜¬ ìˆ˜ê°€ ì—†ë‹¤

env ë¬¸ì œë¡œ ì‹œê°„ì„ ë§Žì´ í—ˆë¹„í–ˆëŠ”ë° ë‹¤ë¥¸ê³³ì—ì„œëŠ” ì•ˆ ì•Œë ¤ì£¼ëŠ” ê¿€íŒì´ê³  ì´ê±° ê´€ë ¨ëœ ì˜¤ë¥˜ë„ ì•ˆë‚œë‹¤.. ë‹¤ë¥¸ ì˜¤ë¥˜ë¡œ í‘œì‹œë˜ì„œ ì‚¬ëžŒì€ ëª¨ë¥´ë‹ˆê¹ ê¼­ envë¥¼ ì‚¬ìš©í•˜ë©´ dotenv/config ë„ ë¶ˆëŸ¬ì˜¤ë„ë¡ ì„¤ì •í•´ì£¼ìž. 

EXPRESS ë˜ëŠ” ë¹„ë™ê¸° NODE APPì€ JEST í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì´ ëª¨ë‘ ì™„ë£Œë˜ì–´ë„ ë¹„ë™ê¸°ê°€ ë‚¨ì•„ìžˆëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ jestê°€ ì¢…ë£Œë˜ì§€ ì•ŠëŠ”ë° detectOpenHandles ì˜µì…˜ì€ ì—´ë ¤ìžˆëŠ” í•¸ë“¤ì„ ëª¨ë‘ ìˆ˜ì§‘í•˜ê³  forceExit ì˜µì…˜ì€ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ê°•ì œ ì¢…ë£Œí•˜ë¼ëŠ” ì˜ë¯¸ì˜ ì˜µì…˜ì´ë‹¤.

ì´ê±¸ë¡œ ê¸°ë³¸ì ì¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„¤ì •ì€ ëª¨ë‘ ëë‚¬ë‹¤.

## ðŸ§‘â€ðŸ’» ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„±í•´ë³´ê¸°

testë¥¼ ìž‘ì„±í•˜ëŠ” íŒŒì¼ì€ íŒŒì¼ëª….test.ts í˜•ì‹ìœ¼ë¡œ ìž‘ì„±í•˜ë©´ ëœë‹¤.

ex) ìœ ì € í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ” ê²½ìš° user.test.ts ë¡œ íŒŒì¼ëª… ì§“ê¸° 

describe : ì—¬ëŸ¬ê°œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë¬¶ì–´ì„œ ê°€ë…ì„±ì„ ë†’ì¸ë‹¤.

test / it : í…ŒìŠ¤íŠ¸ ë‹¨ìœ„

Methods LIST : ì „ì—­ì— ì“°ë©´ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì ìš©ë˜ê³  ë¬¶ì€ describe ì†ì— ë„£ìœ¼ë©´ ê·¸ ì†ì— ìžˆëŠ” testì—ë§Œ methodsê°€ ì ìš©ëœë‹¤.

- afterAll(fn, timeout) : ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ê³  ì‹¤í–‰ëœë‹¤
- afterEach(fn, timeout) : í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ê°€ ëë‚  ë•Œë§ˆë‹¤ ì‹¤í–‰ëœë‹¤
- beforeAll(fn, timeout): ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì‹œìž‘í•˜ê¸° ì „ì— í•œë²ˆ ì‹¤í–‰ëœë‹¤.
- beforeEach(fn, timeout): í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ê°€ ì‹œìž‘í•˜ê¸° ì „ì— ë§¤ë²ˆ ì‹¤í–‰í•œë‹¤

```tsx
describe('í…ŒìŠ¤íŠ¸ ë‹¨ìœ„', () => {
    beforeAll(() => {
      ...
    });

    afterAll(() => {
     ...
    });

    test('[GET] /user', (done) => {
      ...
    });
});
```

src/tests/user.test.ts

```tsx
import request from 'supertest';
import App from '../app';
import AuthRoute from '../routes/auth.route';
import BoardRoute from '../routes/board.route';
import { CreateUserDto } from '../dtos/users.dto';

afterAll(async () => {
  await new Promise<void>((resolve) => setTimeout(() => resolve(), 500));
});

//ìŠ¤ì½”í”„ë¥¼ ê³µìœ í•´ì„œ ê°€ë…ì„± ë†’ì´ê¸° (í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë¬¶ê¸°)
describe('Testing Auth', () => {
  describe('ì„œë²„ ìƒíƒœ í™•ì¸', () => {
    test('ê¸°ë¡ ì²´í¬', async (done) => {
      const reoute = new BoardRoute(); //ë¼ìš°íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const app = new App([reoute]); //
      const response: any = await request(app.getServer()).get('/board/free'); //ë¦¬í€˜ìŠ¤íŠ¸ ìš”ì²­

      // console.log(response);
      expect(response.statusCode).toBe(200);
      done();
    });
  });

  describe('[POST] /login', () => {
    it('testsetestestestsetest', async () => {
      const userData: CreateUserDto = {
        id: 'test',
        password: 'tset',
      };

      const reoute = new AuthRoute();
      const app = new App([reoute]);

      return request(app.getServer())
        .post(`${reoute.path}/login`)
        .send(userData)
        .set('Accept', 'application/json');
    });
  });
});
```